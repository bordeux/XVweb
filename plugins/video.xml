<?xml version="1.0" encoding="utf-8"?>
<plugin>
  <info>
    <name>Youtube and Vimeo</name>
    <version>1.0</version>
    <author>Krzysztof Bednarczyk</author>
    <url>http://www.bordeux.net</url>
    <description>YouTube and Vimeo for XVweb. For use: &lt;youtube&gt;youtubelink&lt;/youtube&gt; or &lt;vimeo&gt;vimeolink&lt;/vimeo&gt;</description>
  </info>
  <config>
    <parser>
      <function tag="youtube">	
	  <![CDATA[
	  if (!function_exists('youtubeid')) {
					function youtubeid($url) {
						parse_str(parse_url($url, PHP_URL_QUERY),$Result);
						if(isset($Result["v"])){
						return array("video", htmlspecialchars(substr( $Result["v"],0 ,16), ENT_QUOTES));} elseif(isset($Result["p"])){
						return array("playlist", htmlspecialchars(substr($Result["p"],0 ,16), ENT_QUOTES));}
					}
				}

				$video_id = youtubeid(pq($element)->text());
				if(is_array($video_id))
			pq($element)->replaceWith("<a href='".(ifsetor($video_id[0],"") == "playlist" ? "http://www.youtube.com/view_play_list?p=" : "http://www.youtube.com/watch?v=").ifsetor($video_id[1], "")."' ".(!is_null(pq($element)->attr('disableplayer')) ? "class='viewplayer'" : "")."><img src='http://img.youtube.com/vi/".ifsetor($video_id[1],0)."/0.jpg' class='yt".ifsetor($video_id[0],"")." setvideo' alt='".ifsetor($video_id[1], "")."' /></a>"); else {
				pq($element)->replaceWith("");
				}
	]]>
	</function>
      <function tag="vimeo">
	  <![CDATA[
	  if (!function_exists('getvimeo')) {
		function getvimeo($url){
			$VimID = str_replace('/','',parse_url(trim($url), PHP_URL_PATH));
			if(is_numeric($VimID))
				return $VimID;
			return false;
		}
	}

	$vimeo_id = getvimeo(pq($element)->html());
	if($vimeo_id){
		pq($element)->replaceWith("<a href='http://vimeo.com/".$vimeo_id."/'><img src='http://img686.imageshack.us/img686/5166/vimeol.png' class='vimeo setvideo' alt='".$vimeo_id."' /></a>");
	}else{
	pq($element)->replaceWith("");
	}
	]]>
	  </function>
    </parser>
  </config>
</plugin>